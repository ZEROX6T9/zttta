<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZTA â€“ My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
    :root {
        --green: #9acd32;
        --dark: #0a0a0a;
        --glass: rgba(15, 15, 15, 0.6);
        --border: rgba(154, 205, 50, 0.25);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: 'Inter', sans-serif;
        background: #000 url('assets/background.jpg') center/cover no-repeat fixed;
        color: #fff;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .navbar {
        width: 100%;
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid #111;
        position: fixed;
        top: 0;
        z-index: 1000;
    }
    .nav-left {
        font-family: 'Orbitron', sans-serif;
        font-size: 28px;
        letter-spacing: 4px;
        color: var(--green);
        font-weight: 700;
    }
    .nav-right a {
        margin-left: 28px;
        color: #ccc;
        text-decoration: none;
        font-weight: 500;
        transition: 0.3s;
    }
    .nav-right a:hover { color: var(--green); }

    .profile-card {
        margin-top: 140px;
        width: 390px;
        background: var(--glass);
        backdrop-filter: blur(20px);
        border-radius: 28px;
        border: 1px solid var(--border);
        padding: 36px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.9);
        position: relative;
        overflow: hidden;
        animation: float 8s ease-in-out infinite;
    }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    .profile-card::before {
        content: '';
        position: absolute;
        top: -50%; left: -50%;
        width: 200%; height: 200%;
        background: conic-gradient(from 0deg, transparent, rgba(154,205,50,0.12), transparent);
        animation: rotate 25s linear infinite;
        pointer-events: none;
    }
    @keyframes rotate { to { transform: rotate(360deg); } }

    .greeting { font-family: 'Orbitron', sans-serif; font-size: 14px; color: #888; letter-spacing: 2px; margin-bottom: 6px; }
    .username { font-family: 'Orbitron', sans-serif; font-size: 34px; font-weight: 700; color: #fff; margin: 0 0 8px 0; letter-spacing: 2px; }
    .user-id { font-size: 12px; color: #666; margin-bottom: 30px; letter-spacing: 1px; }

    .avatar-container {
        position: relative;
        width: 140px;
        height: 140px;
        margin: 0 auto 30px;
        display: block;
        cursor: pointer;
    }
    .avatar {
        width: 140px; height: 140px; border-radius: 50%; object-fit: cover;
        border: 5px solid var(--green); box-shadow: 0 0 40px rgba(154,205,50,0.5); transition: 0.3s;
    }
    .default-avatar {
        width: 140px; height: 140px; border-radius: 50%; background: #111; border: 5px solid #333;
        display: flex; align-items: center; justify-content: center; font-size: 70px; color: #555;
    }
    .avatar-upload-overlay {
        position: absolute; inset: 0; background: rgba(0,0,0,0.75); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s;
        font-size: 32px; color: var(--green);
    }
    .avatar-container:hover .avatar-upload-overlay { opacity: 1; }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    .stat-number { font-family: 'Orbitron', sans-serif; font-size: 30px; font-weight: 700; color: var(--green); }
    .stat-label { font-size: 13px; color: #888; margin-top: 4px; }

    .action-buttons {
        display: flex; gap: 16px; margin-top: 35px; flex-wrap: wrap;
    }
    .btn {
        flex: 1; padding: 16px; border-radius: 16px; font-weight: 600; font-size: 15px;
        cursor: pointer; transition: all 0.3s ease; border: none; min-width: 120px;
    }
    .btn-primary { background: linear-gradient(135deg, #9acd32, #7ba428); color: #000; }
    .btn-secondary { background: rgba(255,255,255,0.08); color: #fff; border: 1px solid rgba(154,205,50,0.3); }
    .btn:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(154,205,50,0.4); }

    .online-status { display: flex; align-items: center; gap: 8px; margin: 30px 0; font-size: 15px; }
    .online-dot { width: 12px; height: 12px; background: var(--green); border-radius: 50%; box-shadow: 0 0 20px var(--green); animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity: 0.7; } 50% { opacity: 1; } }

    .info-list { margin-top: 30px; font-size: 14.5px; border-top: 1px solid rgba(255,255,255,0.08); padding-top: 20px; }
    .info-item { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.05); align-items: center; }
    .label { color: #888; }
    .value { color: #fff; font-weight: 500; }

    /* REDEEM CODE SECTION ON PROFILE */
    .redeem-section {
        margin-top: 30px;
        padding: 20px;
        background: rgba(15,15,15,0.6);
        border-radius: 16px;
        border: 1px solid rgba(154,205,50,0.3);
    }
    .redeem-input {
        width: 100%; padding: 12px; margin: 12px 0;
        background: #111; border: 1px solid #333; border-radius: 8px;
        color: #9acd32; font-size: 16px; text-transform: uppercase;
        text-align: center; letter-spacing: 3px;
    }
    .redeem-btn {
        width: 100%; padding: 14px; background: var(--green); color: #000;
        border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
        transition: 0.3s;
    }
    .redeem-btn:hover { background: #c6ff8a; transform: scale(1.03); }
    .redeem-status {
        margin-top: 12px; font-size: 15px; min-height: 24px; font-weight: bold;
    }
    .success { color: #9acd32; text-shadow: 0 0 15px #9acd32; }
    .error { color: #ff6b6b; }

    footer { margin-top: auto; padding: 50px; text-align: center; color: #555; font-size: 13px; }

    .modal-overlay {
        display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
        align-items: center; justify-content: center; z-index: 2000; opacity: 0; transition: opacity 0.3s;
    }
    .modal-overlay.show { display: flex; opacity: 1; }
    .modal-content {
        background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border);
        border-radius: 24px; padding: 32px; width: 420px; max-width: 90vw;
        box-shadow: 0 20px 80px rgba(0,0,0,0.9); animation: float 6s ease-in-out infinite;
    }
</style>
</head>
<body>

<div class="navbar">
    <div class="nav-left">ZTA</div>
    <div class="nav-right">
        <a href="index.html">Home</a>
        <a href="gallery.html">Gallery</a>
        <a href="blog.html">Blog</a>
        <a href="profile.html">Profile</a>
        <a href="#" id="logoutBtn">Logout</a>
    </div>
</div>

<div class="profile-card">
    <p class="greeting">WELCOME BACK,</p>
    <h1 class="username" id="username">Loading...</h1>
    <p class="user-id" id="userId">UID: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</p>

    <div class="avatar-container" id="mainAvatarContainer">
        <img id="avatar" class="avatar" src="" alt="Profile" style="display:none;">
        <div id="defaultAvatar" class="default-avatar">?</div>
        <div class="avatar-upload-overlay">ðŸ“·</div>
        <input type="file" id="photoInput" accept="image/*">
    </div>

    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-number" id="imagesCount">0</div>
            <div class="stat-label">Images Uploaded</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">350</div>
            <div class="stat-label">Total Likes</div>
        </div>
    </div>

    <div class="action-buttons">
        <button class="btn btn-primary" id="editProfileBtn">Edit Profile</button>
        <button class="btn btn-secondary" id="logoutBtn2">Logout</button>
    </div>

    <div class="online-status">
        <span class="online-dot"></span>
        <span>Online Now</span>
    </div>

    <div class="info-list">
        <div class="info-item"><span class="label">Email</span><span class="value" id="email">â€”</span></div>
        <div class="info-item"><span class="label">Member Since</span><span class="value" id="joined">â€”</span></div>
        <div class="info-item">
            <span class="label">Cosmic Rank</span>
            <span class="value" id="userRole" style="color:#9acd32; font-weight:bold; font-size:17px; text-shadow:0 0 20px #9acd32;">
                Explorer
            </span>
        </div>
    </div>

    <!-- REDEEM CODE SECTION DIRECTLY ON PROFILE -->
    <div class="redeem-section">
        <p style="margin-bottom:12px; color:#aaa; font-size:14px;">Have an exclusive code?</p>
        <input type="text" id="redeemInput" class="redeem-input" placeholder="ENTER 15-LETTER CODE" maxlength="15">
        <button class="redeem-btn" id="redeemBtn">CLAIM RANK</button>
        <div class="redeem-status" id="redeemStatus"></div>
    </div>
</div>

<!-- Edit Profile Modal (unchanged) -->
<div class="modal-overlay" id="editModal">
    <div class="modal-content">
        <h2 style="margin:0 0 24px; font-family:'Orbitron',sans-serif; color:var(--green); letter-spacing:2px;">EDIT PROFILE</h2>
        <div style="text-align:center; margin-bottom:28px;">
            <div class="avatar-container" id="modalAvatarContainer">
                <img id="modalAvatar" class="avatar" src="" alt="Profile" style="display:none;">
                <div id="modalDefaultAvatar" class="default-avatar">?</div>
                <div class="avatar-upload-overlay">ðŸ“·</div>
                <input type="file" id="modalPhotoInput" accept="image/*">
            </div>
            <p style="color:#888; font-size:13px; margin-top:12px;">Click to change avatar</p>
        </div>
        <label style="display:block; margin-bottom:8px; color:#aaa; font-size:14px;">Display Name</label>
        <input type="text" id="modalUsername" placeholder="Your awesome name" 
               style="width:100%; padding:14px 16px; border-radius:12px; border:1px solid #333; background:#111; color:#fff; font-size:15px; margin-bottom:30px;">
        <div style="display:flex; gap:12px;">
            <button class="btn btn-secondary" id="cancelEdit">Cancel</button>
            <button class="btn btn-primary" id="saveProfile">Save Changes</button>
        </div>
    </div>
</div>

<footer>Â© 2025 ZTA â€” Capturing the Universe, One Photon at a Time</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
<script src="firebase.js"></script>

<script>
// 30 Exclusive Redeem Codes (add more anytime!)
const REDEEM_CODES = {
    "PLNHTRFGKLMQZRW": "Planet Hunter",
    "CMSMSTRVJQWYPKT": "Cosmos Master",
    "GLXYFRGRQPTLZNC": "Galaxy Forger",
    "NBLMYSTCQRWJHTF": "Nebula Mystic",
    "STRBLZRPRQJLKYM": "Starblazer Pro",
    "QSRKGNZTWPLXHFD": "Quasar King",
    "VDWLKRZTAQPXJMZ": "Void Walker",
    "PLSAHHTRZQMNDKV": "Pulsar Hunter",
    "AURRCHSRZTWKMLP": "Aurora Chaser",
    "MTORLRDZTXQVNJP": "Meteor Lord",
    "CMTDNCRZTLKWPQS": "Comet Dancer",
    "DRKMTTRZTPXJYQW": "Dark Matter",
    "SPRNOVAZTQJLKMF": "Supernova",
    "BLCKHLZTWQJNPRV": "Black Hole",
    "LGTYRZTAQMWKJPN": "Light Year",
    "ASTRKNGHTZQLPWR": "Astro Knight",
    "CLSTLZTAQWPMJNK": "Celestial",
    "ORNBELTZTQJMKLV": "Orion Belt",
    "ANDRMDAZTAQJXPL": "Andromeda",
    "MLKYWYZTAQPKLJV": "Milky Way",
    "DPSKYZTQJMWLPNK": "Deep Sky",
    "PHTNZTQWPLKJMVF": "Photon",
    "GRVTYZTAQJWPLKM": "Gravity Master",
    "WRMHOLZTAQJKLNP": "Wormhole",
    "EVNTHRZNTQPLKJM": "Event Horizon",
    "CSMCZTAQJWPLKFN": "Cosmic",
    "INFNTYZTAQPLMWJ": "Infinity",
    "PRLLLZTAQJWMPKN": "Parallel",
    "QNTUMZTAQPLJWKM": "Quantum",
    "ETRNLZTAQJWKPLM": "Eternal Observer"
};

// Load used codes and current rank
let usedCodes = JSON.parse(localStorage.getItem("zta_usedCodes")) || [];
let currentRank = localStorage.getItem("zta_cosmicRank") || "Explorer";

firebase.auth().onAuthStateChanged(async (user) => {
    if (!user) {
        window.location.href = "login.html";
        return;
    }

    const userDoc = await firebase.firestore().collection("users").doc(user.uid).get();
    const userData = userDoc.exists ? userDoc.data() : {};

    document.getElementById("username").textContent = userData.username || user.displayName || "Astronomer";
    document.getElementById("userId").textContent = "UID: " + user.uid.slice(0, 12) + "...";
    document.getElementById("email").textContent = user.email;
    document.getElementById("joined").textContent = new Date(user.metadata.creationTime).toLocaleDateString("en-US", {
        year: 'numeric', month: 'long', day: 'numeric'
    });

    const photoURL = user.photoURL || userData.photoURL;
    if (photoURL) {
        document.getElementById("avatar").src = photoURL;
        document.getElementById("avatar").style.display = "block";
        document.getElementById("defaultAvatar").style.display = "none";
    }

    // Display current cosmic rank
    document.getElementById("userRole").textContent = currentRank;

    // Avatar upload (same as before)
    const mainContainer = document.getElementById("mainAvatarContainer");
    const fileInput = document.getElementById("photoInput");
    mainContainer.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) uploadAvatar(file, user);
    });
});

// Redeem Button Logic
document.getElementById("redeemBtn").addEventListener("click", () => {
    const code = document.getElementById("redeemInput").value.trim().toUpperCase();
    const status = document.getElementById("redeemStatus");

    if (code.length !== 15 || !/^[A-Z]{15}$/.test(code)) {
        status.textContent = "Invalid: Must be 15 letters A-Z";
        status.className = "redeem-status error";
        return;
    }

    if (usedCodes.includes(code)) {
        status.textContent = "Already claimed!";
        status.className = "redeem-status error";
        return;
    }

    if (!REDEEM_CODES[code]) {
        status.textContent = "Code not recognized";
        status.className = "redeem-status error";
        return;
    }

    // SUCCESS!
    const newRank = REDEEM_CODES[code];
    usedCodes.push(code);
    currentRank = newRank;

    localStorage.setItem("zta_usedCodes", JSON.stringify(usedCodes));
    localStorage.setItem("zta_cosmicRank", newRank);

    document.getElementById("userRole").textContent = newRank;
    status.innerHTML = `<span class="success">Rank Unlocked: ${newRank} âœ¨</span>`;
    document.getElementById("redeemInput").value = "";
});

// Rest of your existing profile code (avatar upload, edit modal, logout) remains unchanged...
// (Include all your existing uploadAvatar, logout, modal code here - same as before)

async function uploadAvatar(file, user) {
    // ... your existing upload code
}

document.getElementById("logoutBtn").onclick = logout;
document.getElementById("logoutBtn2").onclick = logout;
function logout() {
    if (confirm("Leave the cosmos?")) {
        firebase.auth().signOut().then(() => window.location.href = "login.html");
    }
}

// Edit modal code (unchanged from your original)
const modal = document.getElementById("editModal");
// ... rest of modal code
</script>

<script src="zta.js" defer></script>
</body>
</html>
